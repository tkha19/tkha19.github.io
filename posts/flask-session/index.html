<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Default flask session is insecure</title>
    <meta name="description" content="The undocument flask session">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Kha&#39;s - Journeys and times of me">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Kha&#39;s - Journeys and times of me">
    <link rel="stylesheet" href="/css/index.css">
    

  </head>
  <body>

    <div class="topnav">
        <a href="/" style="vertical-align:middle">
          <img src="/img/home.svg" align="middle" height="18" width="18">
          <span>Kha</span>
        </a>

      <div class="topnav-right">
        <a href="/research">Research</a>
        <a href="/blog">Blog</a>
      </div>
    </div>

    <div id="content">
        <div id="main">
          <main>
            <div class="article">

<h1 class="post-title">Default flask session is insecure</h1>
<div class="when">
  <time datetime="Sunday, October 17, 2021">Posted on Sunday, October 17, 2021</time>
</div>


<p>Let's consider the following deadly simple flask application. The developer stores the secret information in the session key <code>admin_key</code></p>
<pre class="language-python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> session<br><br>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><br><br><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><br><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>    session<span class="token punctuation">[</span><span class="token string">'admin_key'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'foo-bar'</span><br>    <span class="token keyword">return</span> <span class="token string">"&lt;p>Hello, World!&lt;/p>"</span></code></pre>
<p>Run it:</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token assign-left variable">FLASK_APP</span><span class="token operator">=</span>app.py flask run<br><br> * Serving Flask app <span class="token string">'app.py'</span> <span class="token punctuation">(</span>lazy loading<span class="token punctuation">)</span><br> * Environment: production<br>   WARNING: This is a development server. Do not use it <span class="token keyword">in</span> a production deployment.<br>   Use a production WSGI server instead.<br> * Debug mode: off<br> * Running on http://127.0.0.1:5000/ <span class="token punctuation">(</span>Press CTRL+C to quit<span class="token punctuation">)</span></code></pre>
<p>Let's parse the server response</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">curl</span> -ik -vvv http://localhost:5000<br><br>*   Trying <span class="token number">127.0</span>.0.1<span class="token punctuation">..</span>.<br>* TCP_NODELAY <span class="token builtin class-name">set</span><br>* Connected to localhost <span class="token punctuation">(</span><span class="token number">127.0</span>.0.1<span class="token punctuation">)</span> port <span class="token number">5000</span> <span class="token punctuation">(</span><span class="token comment">#0)</span><br><span class="token operator">></span> GET / HTTP/1.1<br><span class="token operator">></span> Host: localhost:5000<br><span class="token operator">></span> User-Agent: curl/7.64.1<br><span class="token operator">></span> Accept: */*<br><span class="token operator">></span><br>* HTTP <span class="token number">1.0</span>, assume close after body<br><span class="token operator">&lt;</span> HTTP/1.0 <span class="token number">200</span> OK<br>HTTP/1.0 <span class="token number">200</span> OK<br><span class="token operator">&lt;</span> Content-Type: text/html<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8<br>Content-Type: text/html<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8<br><span class="token operator">&lt;</span> Content-Length: <span class="token number">11</span><br>Content-Length: <span class="token number">11</span><br><span class="token operator">&lt;</span> Vary: Cookie<br>Vary: Cookie<br><span class="token operator">&lt;</span> Set-Cookie: <span class="token assign-left variable">session</span><span class="token operator">=</span>eyJhZG1pbl9rZXkiOiJmb28tYmFyIn0.YWv3oA.8ccU4eP_3rOH_zFuiemOieKIw40<span class="token punctuation">;</span> HttpOnly<span class="token punctuation">;</span> <span class="token assign-left variable">Path</span><span class="token operator">=</span>/<br>Set-Cookie: <span class="token assign-left variable">session</span><span class="token operator">=</span>eyJhZG1pbl9rZXkiOiJmb28tYmFyIn0.YWv3oA.8ccU4eP_3rOH_zFuiemOieKIw40<span class="token punctuation">;</span> HttpOnly<span class="token punctuation">;</span> <span class="token assign-left variable">Path</span><span class="token operator">=</span>/<br><span class="token operator">&lt;</span> Server: Werkzeug/2.0.1 Python/3.8.12<br>Server: Werkzeug/2.0.1 Python/3.8.12<br><span class="token operator">&lt;</span> Date: Sun, <span class="token number">17</span> Oct <span class="token number">2021</span> <span class="token number">10</span>:14:56 GMT<br>Date: Sun, <span class="token number">17</span> Oct <span class="token number">2021</span> <span class="token number">10</span>:14:56 GMT<br><br><span class="token operator">&lt;</span><br>* Closing connection <span class="token number">0</span><br>Hello world</code></pre>
<p>The <code>Set-Cookie</code> value in HTTP header header is quite interesting for me because it's different from PHP or Java worlds (PHPSESSIONID or JSESSIONID). This value does not look like an id and it's similiar to a JWT token</p>
<pre class="language-bash"><code class="language-bash">eyJhZG1pbl9rZXkiOiJmb28tYmFyIn0.YWv3oA.8ccU4eP_3rOH_zFuiemOieKIw40</code></pre>
<p>Let's dive in how the session is implemented.</p>


<div class="direction"><div class="previous"> <a href="/posts/bash-tips/">Bash tips &amp; tricks</a> Â»</div>
</div>

</div>

          </main>
        </div>
    </div>

    <footer></footer>
  </body>
</html>
